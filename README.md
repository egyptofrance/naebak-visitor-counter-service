# 👁️ خدمة عداد الزوار - Naebak Visitor Counter Service

**خدمة مصغرة لتتبع وعد زوار منصة نائبك**

---

## 🎯 الوصف

هذه خدمة مصغرة مخصصة لتتبع وعد زوار منصة نائبك، تشمل:
- عد الزوار الإجمالي واليومي والفريد
- تتبع مشاهدات الصفحات المختلفة
- إحصائيات الأجهزة والمتصفحات
- حماية من الـ bots والـ rate limiting
- إعادة تعيين يومية تلقائية

---

## 🛠️ التقنيات المستخدمة

- **Flask 2.3.3** - إطار العمل الأساسي
- **Flask-RESTful 0.3.10** - لبناء APIs
- **Redis 5.0.1** - قاعدة البيانات للتخزين السريع
- **APScheduler 3.10.4** - للمهام المجدولة
- **Python 3.11+** - لغة البرمجة

---

## 📁 هيكل المشروع

```
naebak-visitor-counter-service/
├── app.py              # التطبيق الرئيسي مع APIs
├── models.py           # نماذج البيانات وخدمة العداد
├── utils.py            # وظائف مساعدة لتحليل البيانات
├── config.py           # إعدادات التطبيق
├── constants.py        # الثوابت والبيانات الأساسية
├── requirements.txt    # التبعيات المطلوبة
├── .env               # متغيرات البيئة
└── README.md          # هذا الملف
```

---

## ⚙️ الإعدادات

### متغيرات البيئة (.env)

```env
FLASK_APP=app.py
FLASK_ENV=development
REDIS_URL=redis://localhost:6379/1
SECRET_KEY=visitor-counter-secret-key
PORT=8006

# إعدادات العداد
COUNT_UNIQUE_IPS=true
RESET_DAILY=true
BACKUP_INTERVAL_HOURS=1
MAX_VISITORS_PER_IP=10
RATE_LIMIT_WINDOW=60
```

---

## 🚀 التشغيل

### 1. تثبيت التبعيات
```bash
pip install -r requirements.txt
```

### 2. تشغيل Redis
```bash
redis-server
```

### 3. تشغيل التطبيق
```bash
python app.py
```

---

## 📡 واجهات برمجة التطبيقات (APIs)

### تسجيل الزيارات

#### `POST /api/visitors/count/`
تسجيل زيارة جديدة

**Body (اختياري):**
```json
{
  "page": "home",
  "governorate": "CAI"
}
```

**استجابة مثال:**
```json
{
  "message": "تم تسجيل الزيارة بنجاح",
  "visitor_info": {
    "device_type": "حاسوب مكتبي",
    "browser": "جوجل كروم",
    "page": "الصفحة الرئيسية"
  }
}
```

### الإحصائيات

#### `GET /api/visitors/stats/`
الحصول على إحصائيات الزوار الإجمالية

**استجابة مثال:**
```json
{
  "total_visitors": 15000,
  "daily_visitors": 450,
  "unique_visitors": 8500,
  "page_views": 25000,
  "last_reset": "2024-01-15T00:00:00"
}
```

#### `GET /api/visitors/pages/`
إحصائيات الصفحات

**استجابة مثال:**
```json
[
  {
    "page": "home",
    "page_name": "الصفحة الرئيسية",
    "views": 1200,
    "unique_visitors": 400
  },
  {
    "page": "candidates",
    "page_name": "صفحة المرشحين",
    "views": 800,
    "unique_visitors": 267
  }
]
```

#### `GET /api/visitors/hourly/`
إحصائيات الساعات

#### `GET /api/visitors/tracked-pages/`
قائمة الصفحات المتتبعة

### أدوات الإدارة

#### `POST /api/visitors/reset/`
إعادة تعيين العدادات اليومية

#### `GET /health`
فحص صحة الخدمة

---

## 📊 الميزات المتقدمة

### 🔍 **تحليل البيانات التلقائي**
- **تحديد نوع الجهاز:** حاسوب مكتبي، هاتف محمول، جهاز لوحي
- **تحديد المتصفح:** Chrome, Firefox, Safari, Edge, Opera
- **تحديد فترة اليوم:** صباح، ظهر، مساء، ليل

### 🛡️ **الحماية والأمان**
- **حماية من الـ Bots:** تجاهل تلقائي للـ crawlers والـ bots
- **Rate Limiting:** حد أقصى للزيارات لكل IP
- **تنظيف البيانات:** حذف تلقائي للبيانات القديمة

### ⏰ **المهام المجدولة**
- **إعادة تعيين يومية:** في منتصف الليل تلقائياً
- **نسخ احتياطي:** كل ساعة (قابل للتخصيص)

---

## 📈 الصفحات المتتبعة

1. **الصفحة الرئيسية** (`/`)
2. **صفحة المرشحين** (`/candidates`)
3. **صفحة الأعضاء** (`/members`)
4. **صفحة الشكاوى** (`/complaints`)
5. **صفحة الرسائل** (`/messages`)
6. **صفحة حول المنصة** (`/about`)
7. **صفحة اتصل بنا** (`/contact`)

---

## 🔧 التطوير

### إضافة صفحة جديدة للتتبع:
```python
# في constants.py
TRACKED_PAGES.append({
    'page': 'new_page',
    'name': 'الصفحة الجديدة',
    'name_en': 'New Page',
    'path': '/new-page',
    'description': 'وصف الصفحة الجديدة'
})
```

### تخصيص إعدادات Rate Limiting:
```env
MAX_VISITORS_PER_IP=20  # زيادة الحد الأقصى
RATE_LIMIT_WINDOW=120   # زيادة النافزة الزمنية
```

---

## 📝 ملاحظات

- البيانات الافتراضية للاختبار يتم تحميلها تلقائياً عند بدء التشغيل
- الخدمة مصممة للعمل على المنفذ 8006
- تدعم التشغيل في بيئة التطوير والإنتاج
- البيانات محفوظة في Redis مع انتهاء صلاحية تلقائي
- المهام المجدولة تعمل في الخلفية تلقائياً

---

## 🔗 التكامل مع الخدمات الأخرى

هذه الخدمة تتكامل مع:
- **خدمة الإحصائيات** - لتوفير بيانات الزوار
- **خدمة Gateway** - لتوجيه الطلبات
- **الواجهة الأمامية** - لتتبع تفاعل المستخدمين
